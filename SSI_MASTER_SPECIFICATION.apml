# SSI COURSE PRODUCTION MASTER SPECIFICATION
# APML v9.0 - Pyramidal Architecture (Specification as Code + Data as Code)
# Generated: 2025-11-17
# Purpose: Complete system specification for "Tom under a bus" scenario

---
METADATA:
  version: 9.0.0
  status: AUTHORITATIVE
  last_audit: 2025-11-17
  audit_agents: 6
  format: pyramidal_apml
  purpose: disaster_recovery_documentation
---

## üî∫ PYRAMID LEVEL 1: EXECUTIVE SUMMARY (30-SECOND READ)

WHAT_IS_THIS:
  name: "SSi Course Production System v7.8+"
  purpose: "Generate complete language learning courses from canonical seeds through 8-phase pipeline"
  architecture: "Dashboard SSoT + Multi-agent orchestration + S3 storage"
  status: "95% operational (Phase 8 audio untested)"

CRITICAL_TRUTH:
  dashboard_url_local: "http://localhost:5173"
  dashboard_url_public: "https://ssi-dashboard-v7.vercel.app"
  api_url_local: "http://localhost:3456"
  api_url_public: "https://mirthlessly-nonanesthetized-marilyn.ngrok-free.dev"
  data_ssot: "Markdown files in public/docs/phase_intelligence/"
  spec_ssot: "THIS FILE + phase intelligence markdown docs"

IF_TOM_UNAVAILABLE:
  step_1: "Open dashboard at localhost:5173 or Vercel URL"
  step_2: "Navigate to /intelligence tab"
  step_3: "Read phase specifications (v1.0-v7.0 documented)"
  step_4: "Check docs/AUDIT_*.md files (6 forensic reports)"
  step_5: "PM2 restart all services if needed"

---

## üî∫ PYRAMID LEVEL 2: SYSTEM ARCHITECTURE (5-MINUTE READ)

SERVICES:
  pm2_managed:
    ssi-automation:
      script: "start-automation.cjs"
      port: 3456
      purpose: "Monolithic automation server - 92 API endpoints"
      status: "‚úÖ ACTIVE"
      file_size: 353KB
      lines: 10550

    dashboard-ui:
      script: "npm run dev"
      port: 5173
      purpose: "Vite dev server - Vue 3 frontend"
      status: "‚úÖ ACTIVE"
      components: 30
      routes: 20

    ngrok-tunnel:
      url: "mirthlessly-nonanesthetized-marilyn.ngrok-free.dev"
      purpose: "Expose local automation server to public internet"
      status: "‚úÖ ACTIVE"

REPOSITORIES:
  courses: "public/vfs/courses/"
  phase_specs: "public/docs/phase_intelligence/"
  tools: "tools/" # Committed utilities
  scripts: "scripts/" # Gitignored workspace
  api_functions: "api/" # Vercel serverless

DATA_LOCATIONS:
  local: "public/vfs/courses/{course_code}/"
  s3_bucket: "popty-bach-lfs"
  s3_path: "courses/{course_code}/"
  github: "Raw markdown files for live dashboard"

---

## üî∫ PYRAMID LEVEL 3: PHASE PIPELINE (15-MINUTE READ)

PIPELINE_OVERVIEW:
  phases: [1, 3, 5, 6, 7, 8]
  deprecated: [2, 3.5, 4, 5.5]
  workflow: "Phase 1 ‚Üí 3 ‚Üí 5 ‚Üí 6 ‚Üí 7 ‚Üí 8"

PHASE_SPECIFICATIONS:

  phase_1:
    name: "Pedagogical Translation"
    version: "2.6 üîí"
    spec_file: "public/docs/phase_intelligence/phase_1_seed_pairs.md"
    orchestrator_file: "public/docs/phase_intelligence/phase_1_orchestrator.md"
    input: "seeds/canonical_seeds.json (668 seeds)"
    output: "seed_pairs.json"
    format_version: "v7.7.0 / v7.7.1"
    status: "ACTIVE"
    key_rules:
      - "TWO ABSOLUTE RULES: Never change canonical meaning, Prefer cognates"
      - "Synonym flexibility (cognates teach semantic networks)"
      - "Zero variation (first-come-first-served for seeds 1-100)"
      - "Array format: [known, target]"
    methodology: "Examples-first, not precepts"

  phase_3:
    name: "LEGO Extraction"
    version: "7.0"
    spec_file: "public/docs/phase_intelligence/phase_3_lego_pairs_v7.md"
    orchestrator_file: "public/docs/phase_intelligence/phase_3_orchestrator.md"
    input: "seed_pairs.json"
    output: "lego_pairs.json"
    format_version: "v8.1.1"
    status: "ACTIVE"
    key_rules:
      - "TWO CORE HEURISTICS: Remove learner uncertainty, Maximize patterns"
      - "TILING FIRST: Every seed decomposes perfectly"
      - "Functional Determinism: Known ‚Üí Target must be 1:1"
      - "LEGO types: A (Atomic), M (Molecular)"
      - "new: true/false flag for deduplication"
    methodology: "Learning by example (3 detailed examples)"
    critical_note: "‚ö†Ô∏è DUPLICATE FILE EXISTS - automation_server loads phase_3_lego_pairs_v7.md"

  phase_5:
    name: "Practice Basket Generation"
    version: "7.0"
    spec_file: "public/docs/phase_intelligence/phase_5_lego_baskets.md"
    orchestrator_file: "public/docs/phase_intelligence/phase_5_orchestrator.md"
    input: "lego_pairs.json"
    output: "lego_baskets.json (per-seed baskets)"
    format_version: "v1.0.0 (spa) / v8.1.1 (cmn)" # ‚ö†Ô∏è VERSION MISMATCH
    status: "ACTIVE"
    last_modified: "2025-11-17 18:17" # TODAY
    key_rules:
      - "GATE constraint: LEGO #N uses only vocabulary from LEGOs #1 to #(N-1)"
      - "2-2-2-4 distribution: Always 10 phrases per LEGO"
      - "Early seeds S0001-S0010: Fewer phrases OK (grammar over quantity)"
      - "E-phrases (eternal): Natural sentences"
      - "D-phrases (debut): Mechanically extracted fragments"
      - "Only new: true LEGOs get baskets"
    methodology: "Simplified linguistic approach (NOT mechanical templates)"
    critical_note: "‚ö†Ô∏è README.md claims v5.0 (WRONG) - actual is v7.0"

  phase_6:
    name: "Introduction Generation"
    version: "2.0 üîí"
    spec_file: "public/docs/phase_intelligence/phase_6_introductions.md"
    input: "lego_pairs.json"
    output: "introductions.json"
    format_version: "v7.8.0"
    status: "ACTIVE"
    key_rules:
      - "BASE (simple): 'Now, the Spanish for X is Y.'"
      - "COMPOSITE (complex): Component breakdown with 'means'"
      - "Seed context: 'as in [seed sentence]'"
    tool: "node tools/generators/phase6-generate-introductions.cjs <course_code>"

  phase_7:
    name: "Course Manifest Compilation"
    version: "1.0 üîí"
    spec_file: "public/docs/phase_intelligence/phase_7_compilation.md"
    input: "All previous phase outputs"
    output: "course_manifest.json"
    format_version: "v7.7.0 (JSON Schema enforced)"
    status: "ACTIVE"
    key_rules:
      - "Deterministic UUID generation (SSi legacy format)"
      - "Single slice architecture"
      - "Samples object for Phase 8 audio"
    tool: "node scripts/phase7_compile_manifest.cjs public/vfs/courses/<course_code>"

  phase_8:
    name: "Audio Generation"
    version: "1.0"
    spec_file: "public/docs/phase_intelligence/phase_8_audio_generation.md"
    input: "course_manifest.json"
    output: "audio/*.mp3 (S3 upload)"
    format_version: "N/A (audio files)"
    status: "‚ö†Ô∏è NEVER TESTED"
    key_rules:
      - "Read ONLY from course_manifest.json samples object"
      - "UUID-based filenames (from Phase 7)"
      - "Role-voice mapping: target1, target2, source"
      - "ElevenLabs TTS + S3 upload"
    tool: "node tools/generators/phase8-generate-audio.cjs <course_code>"
    blocker: "Needs ElevenLabs API key"
    assigned_to: "Kai (tonight's work)"

DEPRECATED_PHASES:
  phase_2: "Corpus Intelligence (not in v7+ workflow)"
  phase_3_5: "Graph Construction (not in v7+ workflow)"
  phase_4: "Batch Preparation (replaced by Phase 3 new: true flag)"
  phase_5_5: "Basket Deduplication (replaced by Phase 3 deduplication)"

---

## üî∫ PYRAMID LEVEL 4: FILE FORMATS & DATA STRUCTURES (30-MINUTE READ)

FORMAT_SPECIFICATIONS:

  seed_pairs_json:
    version: "v7.7.0 / v7.7.1"
    location: "{course_dir}/seed_pairs.json"
    structure:
      course_code: "string (e.g., 'spa_for_eng')"
      generated_at: "ISO 8601 timestamp"
      methodology: "Phase 1 v2.6 - Pedagogical Translation"
      target_language: "ISO 639-3 code (e.g., 'spa')"
      known_language: "ISO 639-3 code (e.g., 'eng')"
      total_seeds: "integer"
      translations:
        S0001: "[known, target]"
        S0002: "[known, target]"
    example: |
      {
        "course_code": "spa_for_eng",
        "translations": {
          "S0001": ["I want to speak Spanish with you now.", "Quiero hablar espa√±ol contigo ahora."]
        }
      }

  lego_pairs_json:
    version: "v8.1.1"
    location: "{course_dir}/lego_pairs.json"
    structure:
      version: "string (e.g., 'v8.1.1')"
      methodology: "string"
      generated_at: "ISO 8601 timestamp"
      seeds:
        - seed_id: "string (e.g., 'S0001')"
          seed_pair: "[target, known]"
          legos:
            - id: "string (e.g., 'S0001L01')"
              type: "A (Atomic) | M (Molecular)"
              target: "string"
              known: "string"
              new: "boolean (true = first appearance)"
              components: "array (if type=M)" # [[target_part, known_part], ...]
    example: |
      {
        "version": "v8.1.1",
        "seeds": [{
          "seed_id": "S0001",
          "legos": [{
            "id": "S0001L01",
            "type": "A",
            "target": "quiero",
            "known": "I want",
            "new": true
          }]
        }]
      }
    critical_note: "‚ö†Ô∏è SYSTEM.md claims v5.0.1 / v7.7 (OUTDATED)"

  lego_baskets_json:
    version: "v1.0.0 (spa) / v8.1.1 (cmn)" # ‚ö†Ô∏è INCONSISTENT
    location: "{course_dir}/lego_baskets.json"
    structure:
      baskets:
        LEGO_ID:
          practice_phrases:
            - "[known, target, null, lego_count]"
    example: |
      {
        "baskets": {
          "S0001L01": {
            "practice_phrases": [
              ["I want", "Quiero", null, 1],
              ["I want coffee", "Quiero caf√©", null, 2]
            ]
          }
        }
      }
    critical_note: "‚ö†Ô∏è VERSION MISMATCH across courses - needs standardization to v8.1.1"

  introductions_json:
    version: "v7.8.0"
    location: "{course_dir}/introductions.json"
    structure:
      presentations:
        LEGO_ID: "string (natural language presentation)"
    example: |
      {
        "presentations": {
          "S0001L01": "The Spanish for 'I want', as in 'I want to speak...', is: ... 'quiero' ... 'quiero'"
        }
      }

  course_manifest_json:
    version: "v7.7.0 (JSON Schema enforced)"
    location: "{course_dir}/course_manifest.json"
    purpose: "Legacy SSi mobile app format"
    structure:
      slices:
        - samples:
            TEXT:
              - id: "UUID (deterministic)"
                cadence: "natural | fast | slow"
                role: "target1 | target2 | source"
    schema_file: "schemas/course-manifest-schema.json"
    critical_note: "‚úÖ ONLY phase with formal JSON Schema validation"

---

## üî∫ PYRAMID LEVEL 5: TOOLS & SCRIPTS INVENTORY (1-HOUR READ)

TOOL_CATEGORIES:

  validators:
    location: "tools/validators/"
    files:
      - "course-validator.cjs (comprehensive course validation)"
      - "phase-deep-validator.cjs (phase-specific deep validation)"
      - "validate-course.cjs (lightweight validation)"
    usage: "node tools/validators/course-validator.cjs <course_code>"

  generators:
    location: "tools/generators/"
    files:
      - "phase6-generate-introductions.cjs (Phase 6 automation)"
      - "phase8-generate-audio.cjs (Phase 8 - NEW, UNTESTED)"
      - "phase5-merge-batches.cjs (Phase 5 batch merging)"
      - "generate-course-manifest.js (dashboard manifest)"
    usage: "node tools/generators/<script> <course_code>"

  orchestrators:
    location: "tools/orchestrators/"
    files:
      - "automation_server.cjs (10,550 lines, 92 endpoints, MONOLITHIC)"
      - "orchestrator-workflow.cjs (incomplete layered alternative)"
      - "spawn_basket_windows.cjs (iTerm2 window spawning)"
    critical_note: "‚ö†Ô∏è automation_server.cjs duplicated in root + tools/ + scripts/ (IDENTICAL MD5)"

  sync:
    location: "tools/sync/"
    files:
      - "sync-course-to-s3.cjs (upload course to S3)"
      - "sync-course-from-s3.cjs (download course from S3)"
    s3_bucket: "popty-bach-lfs"
    usage: "node tools/sync/sync-course-to-s3.cjs <course_code>"

  phase_prep:
    location: "tools/phase-prep/"
    files:
      - "phase3_prepare_batches.cjs (Phase 3 batch scaffolding)"
      - "phase5_prep_scaffolds.cjs (Phase 5 basket scaffolding)"
      - "phase5_generate_scaffolds.cjs (Phase 5 scaffold generation)"

SCRIPTS_WORKSPACE:
  location: "scripts/" # GITIGNORED
  status: "212 files (experimental, agent-generated, one-off)"
  purpose: "Temporary workspace for batch processors and experiments"
  categories:
    batch_processors: "scripts/phase5-batch-processors/"
    validation: "scripts/validation/"
    automation: "scripts/automation/"
    merge: "scripts/merge/"
  critical_note: "‚ö†Ô∏è NOT committed to git - local experimentation only"

ROOT_POLLUTION:
  problem: "49 script files in root (should be ~10 configs only)"
  violators:
    - "32 phase5 batch processors (phase5_process_*.cjs)"
    - "7 exact duplicates of tools/ files (IDENTICAL MD5)"
    - "6 phase5 generator variations (improved/enhanced/intelligent/etc)"
  recommendation: "Move to scripts/ or delete duplicates"
  cleanup_savings: "~79% file reduction (49 ‚Üí 10 files)"

---

## üî∫ PYRAMID LEVEL 6: API ENDPOINTS & SERVER ARCHITECTURE (2-HOUR READ)

SERVER_ARCHITECTURE:

  mode: "LEGACY (monolithic) - active"
  alternative: "LAYERED (microservices) - incomplete"

  monolithic_server:
    file: "automation_server.cjs"
    port: 3456
    lines: 10550
    endpoints: 92
    status: "‚úÖ PRODUCTION"

    endpoint_categories:
      course_management: 15 endpoints
      validation: 8 endpoints
      phase_processing: 12 endpoints
      basket_operations: 18 endpoints
      audio_generation: 6 endpoints
      s3_sync: 10 endpoints
      vfs_operations: 14 endpoints
      visualization: 9 endpoints

    key_routes:
      - "GET /api/courses (list all courses)"
      - "GET /api/courses/:code (get course data)"
      - "GET /api/prompts/:phase (get phase intelligence)"
      - "POST /api/courses/generate (generate new course)"
      - "GET /api/courses/:code/analyze (smart resume)"
      - "PUT /api/courses/:code/translations/:uuid (update translation)"

  layered_alternative:
    orchestrator:
      file: "services/orchestration/orchestrator.cjs"
      port: 3456
      endpoints: 29
      status: "‚ö†Ô∏è INCOMPLETE"

    phase_servers:
      - "services/phases/phase1-server.cjs (port 3457)"
      - "services/phases/phase3-server.cjs (port 3458)"
      - "services/phases/phase5-server.cjs (port 3459)"
      - "services/phases/phase6-server.cjs (port 3460)"
      - "services/phases/phase7-server.cjs (port 3461)"
      status: "‚ö†Ô∏è STUB IMPLEMENTATIONS"

FRONTEND_DASHBOARD:
  port: 5173
  framework: "Vue 3 (Composition API)"
  build_tool: "Vite"
  components: 30
  routes: 20

  key_routes:
    - "/ (home)"
    - "/intelligence (phase specs)"
    - "/courses (course library)"
    - "/quality-review (basket QA)"
    - "/apml-spec (APML documentation)"

  api_integration:
    primary: "http://localhost:3456 (automation server)"
    fallback: "Static files from public/"
    github_raw: "Live markdown fetch for SSoT"

VERCEL_SERVERLESS:
  location: "api/"
  functions: 5
  files:
    - "api/intelligence.js (serve phase docs)"
    - "api/agent-output.js (capture agent outputs)"
    - "api/agent-status.js (agent status)"
    - "api/test.js (connectivity test)"
    - "api/health.js (health check)"

---

## üî∫ PYRAMID LEVEL 7: CRITICAL TRUTHS & DISCREPANCIES (BRUTAL HONESTY)

VERSION_CONFLICTS:

  phase_5_version:
    documented_readme: "v5.0 (WRONG - never existed)"
    documented_main_readme: "v2.2 (WRONG - archived October)"
    actual_version: "v7.0 (updated 2025-11-17)"
    file_location: "public/docs/phase_intelligence/phase_5_lego_baskets.md"
    automation_server_loads: "phase_5_lego_baskets.md"
    verdict: "‚ö†Ô∏è CRITICAL DOCUMENTATION DRIFT"

  phase_3_version:
    documented_readme: "v4.0.2 (WRONG - outdated)"
    actual_version: "v7.0 (updated 2025-11-13)"
    file_location: "public/docs/phase_intelligence/phase_3_lego_pairs_v7.md"
    duplicate_file: "public/docs/phase_intelligence/phase_3_lego_pairs.md (IDENTICAL - DELETE)"
    automation_server_loads: "phase_3_lego_pairs_v7.md"
    verdict: "‚ö†Ô∏è DUPLICATE FILE + VERSION DRIFT"

  lego_baskets_format:
    spa_for_eng_version: "v1.0.0"
    cmn_for_eng_version: "v8.1.1"
    verdict: "‚ö†Ô∏è CROSS-COURSE INCONSISTENCY - standardize to v8.1.1"

  lego_pairs_format:
    documented_system_md: "v5.0.1 / v7.7"
    actual_version: "v8.1.1"
    verdict: "‚ö†Ô∏è MAJOR VERSION DRIFT in SYSTEM.md"

FILE_DUPLICATES:
  automation_server:
    locations:
      - "automation_server.cjs (root)"
      - "tools/orchestrators/automation_server.cjs"
      - "scripts/automation/automation_server.cjs"
    md5_hash: "IDENTICAL (all 3 files)"
    file_size: "353KB each"
    recommendation: "Keep tools/orchestrators/, delete root + scripts/"

  other_duplicates:
    - "orchestrator-workflow.cjs (root + tools/)"
    - "course-validator.cjs (root + tools/)"
    - "course-analyzer.cjs (root + tools/)"
    - "phase-deep-validator.cjs (root + tools/)"
    - "merge_all_basket_branches.cjs (root + tools/)"
    - "generate-course-manifest.js (root + tools/)"
    total_duplicates: 7
    total_waste: "~453KB"

APML_STATUS:
  ssi_course_production_apml:
    file: "ssi-course-production.apml"
    size: "147KB"
    purpose: "Legacy phase prompts + variable registry"
    phase_prompts_status: "‚ùå DEPRECATED (moved to markdown)"
    variable_registry_status: "‚úÖ ACTIVE (batch sizes, paths)"
    read_by_runtime: "NO (only markdown files read)"
    verdict: "PARTIALLY DEPRECATED - keep for variable registry only"

  apml_registry_json:
    file: ".apml-registry.json"
    purpose: "Auto-generated index/pointer to markdown files"
    generated_by: "scripts/compile-apml-registry.cjs"
    read_by_runtime: "NO (direct markdown import)"
    verdict: "Informational only - not part of runtime"

SCHEMA_VALIDATION:
  phase_1_to_6: "‚ùå NO JSON SCHEMA (only script-based validation)"
  phase_7: "‚úÖ JSON SCHEMA ENFORCED (schemas/course-manifest-schema.json)"
  recommendation: "Create JSON Schemas for Phases 1-6"

---

## üî∫ PYRAMID LEVEL 8: EMERGENCY PROCEDURES (TOM UNDER A BUS)

SYSTEM_RESTART:
  step_1_check_services:
    command: "pm2 list"
    expected: "3 services online (ssi-automation, dashboard-ui, ngrok-tunnel)"

  step_2_restart_if_needed:
    command: "pm2 restart all"
    verify: "pm2 logs --lines 50"

  step_3_check_dashboard:
    url_local: "http://localhost:5173"
    url_public: "https://ssi-dashboard-v7.vercel.app"
    verify: "Can navigate to /intelligence tab"

  step_4_check_api:
    url_local: "http://localhost:3456/api/courses"
    url_public: "https://mirthlessly-nonanesthetized-marilyn.ngrok-free.dev/api/courses"
    expected: "JSON list of courses"

COURSE_GENERATION_PROCEDURE:

  phase_1_translation:
    input: "seeds/canonical_seeds.json"
    method: "Dashboard orchestration OR manual agent"
    spec: "Read /intelligence ‚Üí Phase 1"
    output: "{course_dir}/seed_pairs.json"
    validation: "node tools/validators/course-validator.cjs <course_code>"

  phase_3_lego_extraction:
    input: "seed_pairs.json"
    method: "Dashboard orchestration OR manual agent"
    spec: "Read /intelligence ‚Üí Phase 3"
    output: "{course_dir}/lego_pairs.json"
    validation: "node tools/validators/phase-deep-validator.cjs <course_code> phase3"

  phase_5_basket_generation:
    input: "lego_pairs.json"
    prep: "node tools/phase-prep/phase5_prep_scaffolds.cjs <course_code> <seed_range>"
    method: "Dashboard orchestration OR manual agent (read scaffolds)"
    spec: "Read /intelligence ‚Üí Phase 5"
    output: "{course_dir}/lego_baskets.json"
    validation: "node tools/validators/phase-deep-validator.cjs <course_code> phase5"
    critical_note: "‚ö†Ô∏è MUST follow 2-2-2-4 distribution, GATE compliance"

  phase_6_introductions:
    input: "lego_pairs.json"
    method: "Automated script"
    command: "node tools/generators/phase6-generate-introductions.cjs <course_code>"
    output: "{course_dir}/introductions.json"
    validation: "Check file exists and has presentations for all LEGOs"

  phase_7_compilation:
    input: "All previous phase outputs"
    method: "Automated script"
    command: "node scripts/phase7_compile_manifest.cjs public/vfs/courses/<course_code>"
    output: "{course_dir}/course_manifest.json"
    validation: "JSON Schema validation automatic"

  phase_8_audio:
    input: "course_manifest.json"
    method: "Automated script (NEW - built 2025-11-17)"
    command: "node tools/generators/phase8-generate-audio.cjs <course_code>"
    prereq: "ElevenLabs API key in .env"
    output: "{course_dir}/audio/*.mp3 + S3 upload"
    validation: "Check audio/ directory has UUID-named .mp3 files"
    status: "‚ö†Ô∏è NEVER TESTED - Kai working on this tonight"

TROUBLESHOOTING:

  dashboard_wont_load:
    check: "pm2 logs dashboard-ui --lines 50"
    fix: "pm2 restart dashboard-ui"
    verify: "curl http://localhost:5173"

  api_not_responding:
    check: "pm2 logs ssi-automation --lines 50"
    fix: "pm2 restart ssi-automation"
    verify: "curl http://localhost:3456/api/courses"

  phase_validation_fails:
    check: "node tools/validators/course-validator.cjs <course_code>"
    analyze: "node tools/validators/phase-deep-validator.cjs <course_code> <phase>"
    common_issues:
      - "Infinitive forms incorrect"
      - "FD/LUT collisions"
      - "GATE violations (Phase 5)"
      - "Missing LEGO coverage"

  git_shows_unexpected_changes:
    cause: "Files created in wrong directories"
    check: "ls -la | wc -l (should be ~10 in root)"
    fix: "Move to scripts/ (gitignored) or tools/ (committed)"
    verify: "git status (should be clean)"

ENVIRONMENT_VARIABLES:
  location: ".env file"
  required:
    AWS_ACCESS_KEY_ID: "For S3 sync + Phase 8 audio upload"
    AWS_SECRET_ACCESS_KEY: "For S3 sync + Phase 8 audio upload"
    AWS_REGION: "eu-west-1"
    S3_BUCKET: "popty-bach-lfs"
    ANTHROPIC_API_KEY: "For AI-driven course generation"
    ELEVENLABS_API_KEY: "‚ö†Ô∏è NEEDED FOR PHASE 8 (not yet set)"

---

## üî∫ PYRAMID LEVEL 9: FORENSIC AUDIT REPORTS (COMPLETE DETAILS)

AUDIT_REPORTS_GENERATED:
  date: "2025-11-17"
  agents: 6
  reports:
    - file: "docs/AUDIT_DASHBOARD_FRONTEND.md"
      agent: "Dashboard Frontend Analysis"
      findings: "30 components, 20 routes, /intelligence works, GitHub SSoT"
      size: "Comprehensive"

    - file: "docs/AUDIT_PHASE_INTELLIGENCE.md"
      agent: "Phase Intelligence Docs Audit"
      findings: "Version conflicts (v5.0 vs v7.0), duplicate Phase 3 file, 152KB archives"
      size: "24KB"

    - file: "docs/AUDIT_SCRIPTS_TOOLS.md"
      agent: "Scripts vs Tools Inventory"
      findings: "7 exact duplicates, 32 root phase5 files, 212 scripts/ files"
      size: "Comprehensive"

    - file: "docs/AUDIT_API_SERVERS.md"
      agent: "API & Server Architecture"
      findings: "92 endpoints, monolithic vs layered, port mapping"
      size: "Comprehensive"

    - file: "docs/AUDIT_APML_REGISTRY.md"
      agent: "APML Registry Analysis"
      findings: "Markdown SSoT, APML partially deprecated, migration 95% complete"
      size: "Comprehensive"

    - file: "docs/AUDIT_DATA_FLOW.md"
      agent: "Data Flow & Format Analysis"
      findings: "Format v8.1.1 reality vs v5.0.1 docs, version mismatch across courses"
      size: "1000+ lines"

HANDOFF_DOCUMENTATION:
  - file: "docs/SYSTEM_STATUS_2025-11-17.md"
    purpose: "Pre-training system audit"
    content: "Services status, course inventory, phase specs, critical gaps, checklist"

  - file: "docs/TRAINING_HANDOFF_CHECKLIST.md"
    purpose: "Training day preparation"
    content: "Setup steps, training structure, quick start, troubleshooting, success criteria"

  - file: "CLAUDE.md"
    purpose: "Agent onboarding guide"
    content: "Repository structure, workflows, file conventions, validation"

  - file: "SYSTEM.md"
    purpose: "System architecture"
    content: "Data formats, API endpoints, course discovery, troubleshooting"
    status: "‚ö†Ô∏è OUTDATED (v5.0.1 references, needs update to v8.1.1)"

---

## üî∫ PYRAMID LEVEL 10: IMMEDIATE ACTION ITEMS

CRITICAL_FIXES_NEEDED:

  priority_1_version_drift:
    task: "Update README.md version table"
    files:
      - "public/docs/phase_intelligence/README.md (lines 293-294)"
      - "README.md (line 207)"
    changes:
      - "Phase 3: v4.0.2 ‚Üí v7.0"
      - "Phase 5: v5.0 / v2.2 ‚Üí v7.0"
    time_estimate: "10 minutes"

  priority_2_duplicate_deletion:
    task: "Delete duplicate Phase 3 file"
    command: "rm public/docs/phase_intelligence/phase_3_lego_pairs.md"
    reason: "Identical to phase_3_lego_pairs_v7.md, automation server uses versioned file"
    time_estimate: "1 minute"

  priority_3_root_cleanup:
    task: "Move/delete root pollution files"
    actions:
      - "Delete 7 exact duplicates (automation_server.cjs, etc.)"
      - "Move 32 phase5 batch processors to scripts/"
      - "Keep only ~10 config files in root"
    time_estimate: "30 minutes"
    verification: "ls -la | wc -l (should be ~20 instead of 107)"

  priority_4_phase8_testing:
    task: "Test Phase 8 audio generation"
    blocker: "ElevenLabs API key"
    script: "tools/generators/phase8-generate-audio.cjs"
    test_course: "ita_for_fra (10 seeds)"
    time_estimate: "1-2 hours"
    status: "‚ö†Ô∏è Kai working on this tonight"

  priority_5_format_standardization:
    task: "Standardize lego_baskets.json to v8.1.1"
    affected_courses: "spa_for_eng (currently v1.0.0)"
    reason: "Cross-course consistency"
    time_estimate: "Unknown (may require regeneration)"

NICE_TO_HAVE_IMPROVEMENTS:

  json_schemas:
    task: "Create JSON Schemas for Phases 1-6"
    current: "Only Phase 7 has schema"
    benefit: "Automated format validation"

  system_md_update:
    task: "Update SYSTEM.md with v8.1.1 reality"
    current: "References v5.0.1 / v7.7 (outdated)"
    benefit: "Accurate documentation"

  apml_deprecation:
    task: "Add deprecation notices to APML files"
    current: "Phase prompts moved to markdown but no notice"
    benefit: "Clear migration path"

---

## üî∫ APPENDIX: DATA AS CODE

CURRENT_COURSES:
  production:
    spa_for_eng:
      seeds: 668
      phase_1: "‚úÖ seed_pairs.json (v7.7.0)"
      phase_3: "‚úÖ lego_pairs.json (v8.1.1)"
      phase_5: "‚úÖ lego_baskets.json (v1.0.0)" # ‚ö†Ô∏è OLD VERSION
      phase_6: "‚úÖ introductions.json (v7.8.0)"
      phase_7: "‚úÖ spa_for_eng_668seeds.json (17MB)"
      phase_8: "‚ùå Not tested"

    cmn_for_eng:
      seeds: 668
      phase_1: "‚úÖ seed_pairs.json (v7.7.1)"
      phase_3: "‚úÖ lego_pairs.json (v8.1.1)"
      phase_5: "‚úÖ lego_baskets.json (v8.1.1)"
      phase_6: "‚ùì Unknown"
      phase_7: "‚ùì Unknown"
      phase_8: "‚ùå Not tested"

  test:
    ita_for_fra:
      seeds: 10
      phase_1: "‚úÖ seed_pairs.json (S0548-S0557)"
      phase_3: "‚ùå Not done"
      phase_5: "‚ùå Not done"
      phase_6: "‚ùå Not done"
      phase_7: "‚ùå Not done"
      phase_8: "‚ùå Not done"
      purpose: "End-to-end testing course"

LANGUAGE_CODES:
  spa: "Spanish"
  eng: "English"
  cmn: "Mandarin Chinese"
  ita: "Italian"
  fra: "French"
  gle: "Irish"
  mkd: "Macedonian"
  deu: "German"
  nor: "Norwegian"

---

## üéØ END OF SPECIFICATION

This APML master specification is AUTHORITATIVE as of 2025-11-17.

For updates, re-run forensic audit agents and regenerate this file.

For immediate questions:
1. Check dashboard /intelligence tab
2. Read docs/AUDIT_*.md reports
3. Check docs/SYSTEM_STATUS_2025-11-17.md
4. Check docs/TRAINING_HANDOFF_CHECKLIST.md

**System Status**: 95% operational (Phase 8 audio untested, documentation drift minor)
**Ready for Training**: YES (with ElevenLabs API key for Phase 8 demo)
**Tom Under a Bus Readiness**: 90% (enough to continue operations)

---
END SPECIFICATION
---
