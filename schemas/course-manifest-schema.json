{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SSi Course Manifest Schema",
  "description": "Final compiled course format for SSi mobile app (Phase 7 output) - v7.7.0",
  "type": "object",
  "required": ["id", "version", "target", "known", "introduction", "slices"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Course identifier (e.g., 'en-ga', 'ita-eng')",
      "pattern": "^[a-z]{2,3}-[a-z]{2,3}$"
    },
    "version": {
      "type": "string",
      "description": "Course version (semantic versioning)"
    },
    "target": {
      "type": "string",
      "description": "Target language code (ISO 639-2/3)",
      "pattern": "^[a-z]{2,3}$"
    },
    "known": {
      "type": "string",
      "description": "Known language code (ISO 639-2/3)",
      "pattern": "^[a-z]{2,3}$"
    },
    "blackBeltBoundary": {
      "type": "integer",
      "description": "Seed index that marks completion boundary"
    },
    "introduction": {
      "type": "object",
      "description": "Course welcome/introduction audio sample",
      "required": ["id", "cadence", "role", "duration"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Welcome audio sample UUID (empty string if not generated yet)"
        },
        "cadence": {
          "type": "string",
          "enum": ["natural"],
          "description": "Always natural for welcome"
        },
        "role": {
          "type": "string",
          "enum": ["presentation"],
          "description": "Always presentation voice (source language)"
        },
        "duration": {
          "type": "number",
          "description": "Audio duration in seconds",
          "default": 0
        }
      }
    },
    "beltAssessor": {
      "type": "object",
      "description": "Belt level assessment configuration"
    },
    "slices": {
      "type": "array",
      "description": "Course content organized in slices (lessons/sessions)",
      "items": {
        "type": "object",
        "required": ["id", "seeds", "samples"],
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "Slice UUID"
          },
          "version": {
            "type": "string",
            "description": "Slice version"
          },
          "seeds": {
            "type": "array",
            "description": "Seeds (base sentences) in this slice",
            "items": {
              "type": "object",
              "required": ["id", "node", "seed_sentence", "introduction_items"],
              "properties": {
                "id": {
                  "type": "string",
                  "format": "uuid"
                },
                "seed_sentence": {
                  "type": "object",
                  "required": ["canonical"],
                  "properties": {
                    "canonical": {
                      "type": "string",
                      "description": "Original canonical known language sentence"
                    }
                  }
                },
                "node": {
                  "type": "object",
                  "required": ["id", "known", "target"],
                  "properties": {
                    "id": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "known": {
                      "$ref": "#/definitions/languageNode"
                    },
                    "target": {
                      "$ref": "#/definitions/languageNode"
                    }
                  }
                },
                "introduction_items": {
                  "type": "array",
                  "description": "LEGOs that build up to the complete seed",
                  "items": {
                    "type": "object",
                    "required": ["id", "node", "presentation"],
                    "properties": {
                      "id": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "node": {
                        "type": "object",
                        "description": "The LEGO being introduced"
                      },
                      "presentation": {
                        "type": "string",
                        "description": "Spoken text introducing this LEGO"
                      },
                      "nodes": {
                        "type": "array",
                        "description": "Practice nodes (expanding windows)",
                        "items": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string",
                              "format": "uuid"
                            },
                            "target": {
                              "$ref": "#/definitions/languageNode"
                            },
                            "known": {
                              "$ref": "#/definitions/languageNode"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "samples": {
            "type": "object",
            "description": "Audio samples keyed by phrase text",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["id", "cadence", "role", "duration"],
                "properties": {
                  "id": {
                    "type": "string",
                    "format": "uuid",
                    "description": "Audio file UUID"
                  },
                  "cadence": {
                    "type": "string",
                    "enum": ["natural", "slow", "fast"],
                    "description": "Speaking speed"
                  },
                  "role": {
                    "type": "string",
                    "enum": ["target1", "target2", "source", "presentation"],
                    "description": "Voice role (target1=primary target voice, target2=alternate target voice, source=known language, presentation=teaching voice including encouragement messages)"
                  },
                  "duration": {
                    "type": "number",
                    "description": "Audio duration in seconds",
                    "default": 0
                  },
                  "is_encouragement": {
                    "type": "boolean",
                    "description": "Flag to identify encouragement samples",
                    "default": false
                  }
                }
              }
            }
          },
          "pooledEncouragements": {
            "type": "array",
            "description": "Random encouragement messages in source language",
            "items": {
              "$ref": "#/definitions/encouragement"
            }
          },
          "orderedEncouragements": {
            "type": "array",
            "description": "Sequential encouragement messages in source language",
            "items": {
              "$ref": "#/definitions/encouragement"
            }
          }
        }
      }
    }
  },
  "definitions": {
    "languageNode": {
      "type": "object",
      "required": ["text", "tokens", "lemmas"],
      "properties": {
        "text": {
          "type": "string",
          "description": "Complete phrase text"
        },
        "tokens": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Tokenized words"
        },
        "lemmas": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Lemmatized forms"
        }
      }
    },
    "encouragement": {
      "type": "object",
      "required": ["text", "id"],
      "description": "Encouragement message structure",
      "properties": {
        "text": {
          "type": "string",
          "description": "Encouragement message text in source language",
          "minLength": 1
        },
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "UUID for this encouragement"
        }
      }
    }
  }
}
